# Tests 测试

本目录包含项目的测试脚本和测试数据。

## 📋 测试文件

### 1. `test_api.py`

HTTP API 集成测试脚本，用于测试渲染服务的 API 端点。

#### 功能特性

- ✅ 健康检查测试
- ✅ 渲染功能测试
- ✅ 自动保存生成的图片
- ✅ 详细的测试报告

#### 前置条件

1. **Python 环境**
   - Python 3.6+
   - 安装 `requests` 库：`pip install requests`

2. **服务器运行**
   - 本地运行：`npm start`
   - 或 Docker 运行：`docker run -p 3000:3000 ...`

3. **测试数据**
   - ✅ 测试数据已内嵌在代码中，无需外部文件

#### 使用方法

```bash
# 从项目根目录运行
python tests/test_api.py

# 或从 tests 目录运行
cd tests
python test_api.py
```

#### 测试内容

1. **服务器健康检查**
   - 检查服务器是否运行
   - 验证健康检查端点响应
   - 显示服务器版本信息

2. **渲染功能测试**
   - 发送渲染请求
   - 验证响应状态码
   - 保存生成的图片
   - 显示图片大小和耗时

#### 配置

测试脚本中的配置（可根据需要修改）：

```python
API_URL = "http://localhost:3000/api/render"
HEALTH_URL = "http://localhost:3000/api/health"
```

#### 输出示例

```
============================================================
Markmap 渲染服务测试
============================================================
✓ 服务器运行正常 (版本: 2.0.0)

正在发送渲染请求到 http://localhost:3000/api/render...
Markdown 内容: # 测试思维导图

## 第一部分：基础概念...
图片尺寸: 1920x1080

✓ 渲染成功！
  - 耗时: 3.45 秒
  - 文件: data/mindmap.png
  - 大小: 125,432 字节 (122.49 KB)

============================================================
测试完成！
============================================================
```

#### 故障排除

**连接错误**
```
✗ 无法连接到服务器
  请确保服务器正在运行:
  - 本地运行: npm start
  - Docker: docker run -p 3000:3000 ...
```

**超时错误**
- 检查服务器资源是否充足
- 检查 Markdown 内容是否过大
- 增加超时时间（默认 180 秒）

---

## 🚀 快速开始

```bash
# 1. 启动服务器
npm start

# 2. 在另一个终端运行测试
python tests/test_api.py

# 3. 查看生成的图片
ls -lh data/mindmap.png
```

> **注意**：测试数据已内嵌在代码中，无需外部文件。

---

## 🐛 故障排除

### API 测试失败

**问题：无法连接到服务器**
- 确保服务器正在运行：`npm start`
- 检查端口是否正确（默认 3000）
- 检查防火墙设置

**问题：渲染超时**
- 检查服务器资源
- 检查 Markdown 内容大小
- 增加超时时间


---



